#---------------------------------#
#      general configuration      #
#---------------------------------#

version: 2.0.0.{build}-{branch}

skip_tags: true

#---------------------------------#
#    environment configuration    #
#---------------------------------#

image: Visual Studio 2017

clone_depth: 1

# Do not build feature branch with open Pull Requests. Otherwise every commit on a PR triggers two AppVeyor builds.
skip_branch_with_pr: true

nuget:  
  disable_publish_on_pr: true

environment:
  COVERALLS_REPO_TOKEN:
    secure: R8Ntdx47utdSttS13LQ+doLEkvHa1/8o0YcsX3qSzuyo4YdP76MN/OIfUOiW/u2G

#---------------------------------#
#       build configuration       #
#---------------------------------#

configuration: Release

build_script:
- dotnet --info
- dotnet restore --no-cache
- dotnet build --configuration Release --version-suffix %APPVEYOR_BUILD_NUMBER%
- dotnet pack src/Hystrix.Dotnet/Hystrix.Dotnet.csproj --configuration Release --no-build
- dotnet pack src/Hystrix.Dotnet.AspNet/Hystrix.Dotnet.AspNet.csproj --configuration Release --no-build
- dotnet pack src/Hystrix.Dotnet.AspNetCore/Hystrix.Dotnet.AspNetCore.csproj --configuration Release --no-build
- dotnet pack src/Hystrix.Dotnet.Owin/Hystrix.Dotnet.Owin.csproj --configuration Release --no-build
- dotnet pack src/Hystrix.Dotnet.WebConfiguration/Hystrix.Dotnet.WebConfiguration.csproj --configuration Release --no-build

#---------------------------------#
#       tests configuration       #
#---------------------------------#

test_script:
- dotnet test test/Hystrix.Dotnet.UnitTests/Hystrix.Dotnet.UnitTests.csproj --configuration Release --no-build
- dotnet test test/Hystrix.Dotnet.AspNet.UnitTests/Hystrix.Dotnet.AspNet.UnitTests.csproj --configuration Release --no-build
- dotnet test test/Hystrix.Dotnet.AspNetCore.UnitTests/Hystrix.Dotnet.AspNetCore.UnitTests.csproj --configuration Release --no-build
- dotnet test test/Hystrix.Dotnet.Owin.UnitTests/Hystrix.Dotnet.Owin.UnitTests.csproj --configuration Release --no-build
- dotnet test test/Hystrix.Dotnet.WebConfiguration.UnitTests/Hystrix.Dotnet.WebConfiguration.UnitTests.csproj --configuration Release --no-build
- bash coverage.sh
- bash coveralls.sh

#---------------------------------#
#      artifacts configuration    #
#---------------------------------#

artifacts:
- path: src/**/*.nupkg

#---------------------------------#
#     deployment configuration    #
#---------------------------------#

deploy: off  
